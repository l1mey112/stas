__global string_buffer     = [4096]u8{}
__global string_buffer_len = u32(0)

[unsafe]
fn get_v_string(ptr &u8) string {
	unsafe {
		return string {
			len: int(*(&u64(ptr)))
			str: &u8(ptr + sizeof(u64))
			is_lit: 1
		}
	}
}

fn push_string_view(str &u8, len int) &u8 {
	sizeof_entry := sizeof(u64) + u32(len)

	if string_buffer_len + sizeof_entry >= 4096 {
		panic("used up all memory")
	}

	unsafe {
		ptr := &string_buffer[string_buffer_len]

		*(&u64(ptr)) = u64(len)
		vmemcpy(ptr + sizeof(u64), str, len)
		*(&u8(ptr + sizeof_entry)) = 0

		string_buffer_len += sizeof_entry + 1

		return ptr
	}
}

fn main() {
	t := fn (a string) {
		ptr := push_string_view(a.str, a.len)
		unsafe {
			println(get_v_string(ptr))
		}
	}

	t('weeeeeee')
	t('hell!!!')
	t('hello!!!!1')
	t('hello!!!!1ee')
}